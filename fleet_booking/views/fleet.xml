<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

    <menuitem action="action_view_remove_vehicle_wizard" parent="fleet.fleet_vehicles" id="fleet_remove_vehicle_menu" groups="fleet.group_fleet_user"/>

    <record id="view_fleet_form_inherit" model="ir.ui.view">
      <field name="name">fleet.vehicle.form.inherit</field>
      <field name="model">fleet.vehicle</field>
      <field name="inherit_id" ref="fleet_rental_document.fleet_vehicle_rental_form"/>
      <field name="arch" type="xml">
        <data>
          <xpath expr="//header/field[@name='state_id']" position="before">
            <button name="%(fleet_booking.action_view_make_bill_wizard)d" string="Create Vendor Bill"
                    type="action" class="btn-primary" groups="fleet_booking.group_vehicles_support_officer"/>
          </xpath>
          <xpath expr="//sheet/div/button[last()]" position="after">
            <button name="action_view_invoice"
                    type="object"
                    class="oe_stat_button"
                    icon="fa-pencil-square-o"
                    context="{'view_type': 'supplier'}">
              <field name="invoice_count" widget="statinfo" string="Vendor Bills"/>
            </button>
          </xpath>
          <xpath expr="//label[@for='tag_ids']" position="before">
            <label for="branch_id" class="oe_edit_only"/>
            <h2>
              <field name="branch_id"/>
            </h2>
            <label for="asset_id" class="oe_edit_only"/>
            <field name='asset_id'/>
            <label for="partner_id" class="oe_edit_only"/>
            <field name='partner_id'/>
          </xpath>
          <xpath expr="//sheet/group[3]/group" position="after">
            <group string="Billing">
              <field name='paid'/>
              <field name='remain'/>
            </group>
          </xpath>
          <xpath expr="//sheet/group[3]" position="after">
            <group>
              <group string="Registration/Insurance Dates">
                <field name='reg_expiry'/>
                <field name='ins_expiry'/>
              </group>
              <group string="Maintenance">
                <field name='next_maintain'/>
              </group>
            </group>
            <group>
              <group string="Accounts">
                <field name='account_asset_id'/>
                <field name='account_depreciation_id'/>
              </group>
            </group>
          </xpath>
          <xpath expr="//sheet/group[1]/group[1]" position="inside">
            <field name='model_year'/>
          </xpath>
          <xpath expr="//sheet" position="inside">
            <notebook groups="fleet_booking.group_accountant,fleet_booking.group_vehicles_support_officer">
              <page string="Depreciation">
                <field name="depreciation_ids" nolabel="1" widget="one2many_list" mode="tree" context="{'vehicle_id': id}">
                  <tree string="Depreciation Lines" decoration-info="(move_check == False)" create="false">
                    <field name="depreciation_date"/>
                    <field name="depreciated_value" readonly="1"/>
                    <field name="amount" widget="monetary" string="Depreciation"/>
                    <field name="remaining_value" readonly="1" widget="monetary" string="Residual"/>
                    <field name="move_check" invisible="1"/>
                    <field name="parent_state" invisible="1"/>
                    <button name="create_move" type="object" widget="widgetonbutton"/>
                  </tree>
                </field>
              </page>
              <page string="Lease Installments dates">
                <field name="lease_installment_date_ids" widget='one2many' nolabel="1" mode="tree">
                  <tree string="Lease Installments dates" editable="bottom">
                    <field name="installment_date"/>
                    <field name="amount"/>
                  </tree>
                </field>
              </page>
              <page string="Insurance Installments dates">
                <field name="insurance_installment_date_ids" widget='one2many' nolabel="1" mode="tree">
                  <tree string="Insurance Installments dates" editable="bottom">
                    <field name="installment_date"/>
                    <field name="amount"/>
                  </tree>
                </field>
              </page>
            </notebook>
          </xpath>
          <xpath expr="//field[@name='state_id']" position="attributes">
            <attribute name="clickable"></attribute>
          </xpath>
        </data>
      </field>
    </record>

    <record id="fleet_vehicle_log_services_form_inherit" model="ir.ui.view">
      <field name="name">fleet.vehicle.log.services.form.inherit</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
      <field name="arch" type="xml">
        <data>
          <xpath expr="//field[@name='cost_subtype_id']" position="after">
            <field name="cost_subtype_in_branch" invisible="True"/>
          </xpath>
          <xpath expr="//field[@name='cost_ids']/.." position="after">
            <group string="Invoices" groups="fleet_booking.group_accountant" invisible="True">
              <field name="account_invoice_ids" nolabel="1"/>
            </group>
          </xpath>
        </data>
      </field>
    </record>

    <record model="ir.ui.view" id="fleet_vehicle_log_services_form_inherit_buttons">
      <field name="name">fleet.vehicle.log.services.form.inherit.buttons</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
      <field name="arch" type="xml">
        <xpath expr="//sheet" position="before">
          <header>
            <button name="submit" states="draft" string="Submit" type="object" class="oe_highlight" groups="fleet_booking.group_branch_officer"/>
            <button name="confirm" attrs="{'invisible': [('state', '!=', 'request')]}"  string="Confirm" type="object" class="oe_highlight" groups="fleet_booking.group_branch_officer,fleet_booking.group_vehicles_support_officer"/>
            <button name="%(fleet_booking.action_view_approve_maintenance_wizard)d" states="done" string="Approve"
                    type="action" class="btn-primary" groups="fleet_booking.group_accountant"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,request,done,paid"/>
          </header>
        </xpath>
        <xpath expr="//label[@for='odometer']/../.." position="before">
          <div class="oe_button_box" name="button_box">
            <button name="action_get_attachment_tree_view"
                    class="oe_stat_button"
                    icon="fa-book"
                    type="object">
              <field name="attachment_number" widget="statinfo" string="Attachments"/>
            </button>
          </div>
        </xpath>
      </field>
    </record>

    <!--BRANCH OFFICER FORM BEHAVIOR CUSTOMISATION-->
    <!--HIDE Included Services-->
    <record id="fleet_vehicle_log_services_form_inherit_bo" model="ir.ui.view">
      <field name="name">fleet.vehicle.log.services.form.inherit.bo</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
      <field name="groups_id" eval="[(4, ref('fleet_booking.group_branch_officer'), 0)]"/>
      <field name="arch" type="xml">
        <data>
          <xpath expr="//field[@name='cost_ids']/.." position="attributes">
            <attribute name='attrs'>{'invisible': [('cost_subtype_in_branch', '=', False)]}</attribute>
          </xpath>
        </data>
      </field>
    </record>

    <record id="fleet_vehicle_log_services_form_inherit_bos" model="ir.ui.view">
      <field name="name">fleet.vehicle.log.services.form.inherit.bos</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet_vehicle_log_services_form_inherit_buttons"/>
      <field name="groups_id" eval="[(4, ref('fleet_booking.group_branch_officer'), 0)]"/>
      <field name="arch" type="xml">
        <data>
          <xpath expr="//button[@name='confirm']" position="attributes">
            <attribute name='attrs'>{'invisible': ['|', ('state', '!=', 'request'),
            '&amp;',('state', '=', 'request') , ('cost_subtype_in_branch', '=', False)]}</attribute>
          </xpath>
        </data>
      </field>
    </record>
    <!-- Customer request: rename 'Make' to 'Brand'. 'Model make of Vehicle' - 'Brand of Vehicle'  -->
    <record id="fleet.fleet_vehicle_model_brand_menu" model="ir.ui.menu">
      <field name="name">Brand of Vehicle</field>
    </record>
    <record id='fleet.fleet_vehicle_model_brand_act' model='ir.actions.act_window'>
      <field name="name">Brand of Vehicle</field>
    </record>
    <!-- Rename 'Vehicles Services Logs' to 'Vehicle Maintenance' -->
    <record id='fleet.fleet_vehicle_log_services_act' model='ir.actions.act_window'>
      <field name="name">Vehicle Maintenance</field>
    </record>
    <record id="fleet.fleet_vehicle_log_services_menu" model="ir.ui.menu">
      <field name="name">Vehicle Maintenance</field>
      <field name="groups_id" eval="[(4, [ref('group_branch_officer')], 0), (4, [ref('group_accountant')], 0)]"/>
    </record>

    <!-- Rename 'Service Type' to 'Maintenance Type' -->
    <record id='fleet.fleet_vehicle_service_types_act' model='ir.actions.act_window'>
      <field name="name">Maintenance Type</field>
    </record>

    <record id="fleet.fleet_vehicle_service_types_menu" model="ir.ui.menu">
      <field name="name">Maintenance Type</field>
    </record>

    <record id='fleet_vehicle_log_services_form' model='ir.ui.view'>
      <field name="name">fleet.vehicle.log.services.form</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='cost_subtype_id']" position="attributes">
          <attribute name='string'>Maintenance Type</attribute>
          <attribute name='invisible'>True</attribute>
        </xpath>
        <xpath expr="//field[@name='cost_subtype_id']" position="after">
          <field name="maintenance_type"/>
        </xpath>
        <xpath expr="//sheet/group[last()]" position="attributes">
          <attribute name='string'>Description of required maintenance</attribute>
        </xpath>
        <xpath expr="//sheet/group[2]" position="attributes">
          <attribute name='invisible'>True</attribute>
        </xpath>
        <xpath expr="//field[@name='cost_ids']" position="attributes">
          <attribute name='string'>Maintenance Type</attribute>
        </xpath>
	      <xpath expr="//field[@name='cost_ids']/.." position="attributes">
          <attribute name='invisible'>True</attribute>
        </xpath>
        <xpath expr="//field[@name='cost_ids']/.." position="after">
          <group col='4' string="Service Description">
            <field colspan='4' name="service_line_ids" nolabel="1">
              <tree string="Service Description" editable="bottom" decoration-success="move_check">
                <field name="move_check" invisible="1"/>
                <field name="item"/>
                <field name="cost"/>
                <field name="debit_account" groups="account.group_account_manager"/>
                <field name="credit_account" groups="account.group_account_manager"/>
              </tree>
            </field>
            <field colspan='4' name="total_cost"/>
          </group>
        </xpath>
        <xpath expr="//field[@name='amount']" position="attributes">
          <attribute name='invisible'>True</attribute>
        </xpath>
        <xpath expr="//field[@name='vehicle_id']" position="attributes">
          <attribute name='domain'>[('state_id.name','=','Available')]</attribute>
        </xpath>
      </field>
    </record>

    <record id='fleet_vehicle_log_services_form_bo' model='ir.ui.view'>
      <field name="name">fleet.vehicle.log.services.form.bo</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet_vehicle_log_services_form"/>
      <field name="groups_id" eval="[(4, ref('fleet_booking.group_branch_officer'), 0)]"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='service_line_ids']/.." position="attributes">
          <attribute name='attrs'>{'invisible':[('maintenance_type', '!=', 'in-branch')]}</attribute>
        </xpath>
        <xpath expr="//field[@name='odometer']/../.." position="attributes">
          <attribute name='attrs'>{'invisible':[('maintenance_type', '!=', 'in-branch')]}</attribute>
        </xpath>
      </field>
    </record>

    <record id="fleet_vehicle_log_services_form_inherit_buttons_bo" model="ir.ui.view">
      <field name="name">fleet.vehicle.log.services.form.inherit.buttons.bo</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet_vehicle_log_services_form_inherit_buttons"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='action_get_attachment_tree_view']/.." position="attributes">
          <attribute name='attrs'>{'invisible':[('maintenance_type', '!=', 'in-branch')]}</attribute>
        </xpath>
      </field>
    </record>

    <record id='fleet_vehicle_model_form' model='ir.ui.view'>
      <field name="name">fleet.vehicle.model.form</field>
      <field name="model">fleet.vehicle.model</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_model_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='brand_id']" position="attributes">
          <attribute name='string'>Brand</attribute>
        </xpath>
        <xpath expr="//label[@for='brand_id']" position="attributes">
          <attribute name='string'>Brand</attribute>
        </xpath>
      </field>
    </record>

    <record id="fleet.menu_root" model="ir.ui.menu">
      <field name="groups_id" eval="[(4, [ref('group_branch_officer')], 0), (4, [ref('group_accountant')], 0)]"/>
    </record>
    <record id="fleet.fleet_vehicles" model="ir.ui.menu">
      <field name="groups_id" eval="[(4, [ref('group_branch_officer')], 0), (4, [ref('group_accountant')], 0)]"/>
    </record>
    <record id="fleet.fleet_vehicle_menu" model="ir.ui.menu">
      <field name="groups_id" eval="[(4, [ref('group_branch_officer')], 0), (4, [ref('group_accountant')], 0)]"/>
    </record>

    <record id='fleet_vehicle_log_services_search_vso' model='ir.ui.view'>
      <field name="name">fleet.vehicle.log.services.search.vso</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_search"/>
      <field name="arch" type="xml">
        <search string="Services Logs">
          <filter string="Requests" name="request" domain="[('state', '=', 'request')]" />
          <filter string="Done" name="done" domain="[('state', '=', 'done')]" />
        </search>
      </field>
    </record>

    <record id='fleet_vehicle_log_services_form_for_acc' model='ir.ui.view'>
      <field name="name">fleet.vehicle.log.services.form.for_acc</field>
      <field name="model">fleet.vehicle.log.services</field>
      <field name="inherit_id" ref="fleet_vehicle_log_services_form"/>
      <field name="groups_id" eval="[(4, ref('fleet_booking.group_accountant'), 0)]"/>
      <field name="arch" type="xml">
        <xpath expr="//tree/field[@name='item']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
        <xpath expr="//tree/field[@name='cost']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
        <xpath expr="//field[@name='maintenance_type']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
        <xpath expr="//field[@name='vehicle_id']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
        <xpath expr="//field[@name='odometer']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
        <xpath expr="//field[@name='notes']" position="attributes">
          <attribute name="readonly">1</attribute>
        </xpath>
      </field>
    </record>

  </data>
</openerp>
