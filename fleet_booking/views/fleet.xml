<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
<record id="view_fleet_form_inherit" model="ir.ui.view">
    <field name="name">fleet.vehicle.form.inherit</field>
    <field name="model">fleet.vehicle</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_form"/>
    <field name="arch" type="xml">
        <data>
            <!-- NEW FIELDS -->
            <xpath expr="//field[@name='company_id']" position="after">
                <field name='branch'/>
            </xpath>
            <xpath expr="//field[@name='doors']" position="after">
                    <field name='model_year'/>
                    <field name='daily_rate'/>
                    <field name='extra_rate'/>
                    <field name='allowed_per_day'/>
                    <field name='paid'/>
                    <field name='remain'/>
                    <field name='reg_expiry'/>
                    <field name='ins_expiry'/>
                    <field name='next_maintain'/>
            </xpath>
            <xpath expr="//sheet" position="inside">
                <sheet string="Invoice">
                    <notebook colspan="4">
                        <page string="Payments">
                            <field name="payments_ids" nolabel="1" widget="one2many_list" mode="tree"
                                   context="{'vehicle_id': id}">
                                <tree string="Payments" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="sequence"/>
                                    <field name='payment_date'/>
                                    <field name='amount'/>
                                </tree>
                            </field>
                        </page>
                        <page string="Insurance">
                            <field name="insurance_ids" nolabel="1" widget="one2many_list" mode="tree"
                                   context="{'vehicle_id': id}">
                                <tree string="Insurance" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="sequence"/>
                                    <field name='insurance_date'/>
                                    <field name='amount'/>
                                </tree>
                            </field>
                        </page>
                        <page string="Deprecation">
                            <field name="deprecation_ids" nolabel="1" widget="one2many_list" mode="tree"
                                   context="{'vehicle_id': id}">
                                <tree string="Insurance" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="sequence"/>
                                    <field name='deprecation_date'/>
                                    <field name='amount'/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </xpath>
            <!-- ALTERED FIELDS -->
            <xpath expr="//h2/field[@name='license_plate']" position="attributes">
                <!--НЕ РАБОТАЕТ ЧТО ТО-->
                <attribute name='string'>Plate Number</attribute>
            </xpath>
            <xpath expr="//field[@name='color']" position="replace">
                <!--СТРАННОЕ ПОВЕДЕНИЕ-->
                <field name='colour'/>
            </xpath>
        </data>
    </field>
</record>
<record id="fleet_vehicle_log_services_form_inherit" model="ir.ui.view">
    <field name="name">fleet.vehicle.log.services.form.inherit</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
    <field name="arch" type="xml">
        <data>
            <xpath expr="//field[@name='cost_subtype_id']" position="after">
                <field name="cost_subtype_in_branch" invisible="True"/>
            </xpath>
            <xpath expr="//field[@name='cost_ids']/.." position="after">
                <group string="Invoices" groups="fleet_booking.group_accountant">
                    <field name="account_invoice_ids" nolabel="1"/>
                </group>
            </xpath>
        </data>
    </field>
</record>
<record model="ir.ui.view" id="fleet_vehicle_log_services_form_inherit_buttons">
    <field name="name">fleet.vehicle.log.services.form.inherit.buttons</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
    <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <button name="submit" states="draft" string="Submit" type="object" class="oe_highlight"/>
                    <button name="confirm" attrs="{'invisible': [('state', '!=', 'request')]}"  string="Confirm" type="object" class="oe_highlight"/>
                    <button name="approve" states="done" string="Approve" type="object" class="oe_highlight"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,request,done,paid"/>
                </header>
            </xpath>
    </field>
</record>
<!--BRANCH OFFICER FORM BEHAVIOR CUSTOMISATION-->
<record id="fleet_vehicle_log_services_form_inherit_bo" model="ir.ui.view">
    <field name="name">fleet.vehicle.log.services.form.inherit.bo</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form"/>
    <field name="groups_id" eval="[(4, ref('fleet_booking.group_branch_officer'), 0)]"/>
    <field name="arch" type="xml">
        <data>
            <xpath expr="//field[@name='cost_ids']/.." position="attributes">
                <attribute name='attrs'>{'invisible': [('cost_subtype_in_branch', '=', False)]}</attribute>
            </xpath>
        </data>
    </field>
</record>
<record id="fleet_vehicle_log_services_form_inherit_bos" model="ir.ui.view">
    <field name="name">fleet.vehicle.log.services.form.inherit.bos</field>
    <field name="model">fleet.vehicle.log.services</field>
    <field name="inherit_id" ref="fleet_vehicle_log_services_form_inherit_buttons"/>
    <field name="groups_id" eval="[(4, ref('fleet_booking.group_branch_officer'), 0)]"/>
    <field name="arch" type="xml">
        <data>
            <xpath expr="//button[@name='confirm']" position="attributes">
                <attribute name='attrs'>{'invisible': ['|', ('state', '!=', 'request'),
                                                      '&amp;',('state', '=', 'request') , ('cost_subtype_in_branch', '=', False)]}</attribute>
            </xpath>
        </data>
    </field>
</record>
</data>
</openerp>
<!--state   inbranch  invisible visible-->
<!--request  true      0           1-->
<!--request  false     1           0-->
<!--any      true      1           0-->
<!--any      false     1           0-->
